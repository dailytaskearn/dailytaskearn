<!DOCTYPE html>
<html>
<head>
  <title>Daily Task Earn</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js"></script>
  <style>
    body { margin: 0; font-family: Arial; background: #ffebee; }
    .container { max-width: 400px; margin: auto; padding: 20px; background: white; border-radius: 10px; margin-top: 40px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button { width: 100%; padding: 10px; margin: 10px 0; }
    .hidden { display: none; }
    h2 { text-align: center; color: #c62828; }
    .red-btn { background: #c62828; color: white; border: none; cursor: pointer; }
    .plan { padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; }
    .active { border-color: #c62828; background: #fbe9e7; }
    #dashboard { text-align: center; }
    a { color: #c62828; text-decoration: none; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container" id="auth">
    <h2>Daily Task Earn</h2>
    <input type="text" id="authUsername" placeholder="Username" />
    <input type="password" id="authPassword" placeholder="Password" />
    <button class="red-btn" onclick="register()">Register</button>
    <button onclick="login()">Login</button>
  </div>

  <div class="container hidden" id="plan">
    <h2>Select Plan</h2>
    <div class="plan" onclick="selectPlan(120)">Rs 120 - 3 Tasks Daily</div>
    <div class="plan" onclick="selectPlan(240)">Rs 240 - 6 Tasks Daily</div>
    <div class="plan" onclick="selectPlan(360)">Rs 360 - 9 Tasks Daily</div>
  </div>

  <div class="container hidden" id="dashboard">
    <h2>Welcome <span id="userName"></span></h2>
    <p>Your Plan: <span id="userPlan"></span> Rs</p>
    <p>Balance: Rs <span id="userBalance">0</span></p>

    <h3>Daily Task</h3>
    <a href="https://youtu.be/kD3oFqa_o_4?si=fHRfB36EF9c19-tq" target="_blank">Watch Task Video</a>
    <br><br>
    <button class="red-btn" onclick="startTimer(this)" id="taskBtn">Complete Task (2 min)</button>

    <h3>Withdraw Request</h3>
    <input type="number" id="withdrawAmount" placeholder="Amount (Rs)" />
    <input type="text" id="trxId" placeholder="TRX ID or Screenshot Link" />
    <button onclick="requestWithdraw()">Submit Withdraw</button>

    <h3>Refer & Earn</h3>
    <p>Share your link and earn Rs 2 per user:</p>
    <input type="text" id="refLink" readonly />

    <h3>Join WhatsApp Channel</h3>
    <a href="https://whatsapp.com/channel/0029VbBnfJ7Au3aQYDF2xd0x" target="_blank">Click to Join</a>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAL1SsfBNXUiSXC3hySfw4M-JTlLqiGMEE",
      authDomain: "dailytask-earn.firebaseapp.com",
      projectId: "dailytask-earn",
      storageBucket: "dailytask-earn.appspot.com",
      messagingSenderId: "807698894430",
      appId: "1:807698894430:web:03e3df5216a2dfc7a52ecf",
      databaseURL: "https://dailytask-earn-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;

    function register() {
      const user = document.getElementById('authUsername').value;
      const pass = document.getElementById('authPassword').value;
      if (!user || !pass) return alert("Fill all fields");
      auth.createUserWithEmailAndPassword(user + "@dte.com", pass).then(res => {
        db.ref("users/" + user).set({ balance: 0, plan: 0 });
        alert("Registered! Now login");
      }).catch(e => alert(e.message));
    }

    function login() {
      const user = document.getElementById('authUsername').value;
      const pass = document.getElementById('authPassword').value;
      if (!user || !pass) return alert("Fill all fields");
      auth.signInWithEmailAndPassword(user + "@dte.com", pass).then(res => {
        currentUser = user;
        document.getElementById("auth").classList.add("hidden");
        checkUserPlan();
      }).catch(e => alert(e.message));
    }

    function checkUserPlan() {
      db.ref("users/" + currentUser).once("value").then(snap => {
        if (snap.exists() && snap.val().plan > 0) {
          showDashboard(snap.val());
        } else {
          document.getElementById("plan").classList.remove("hidden");
        }
      });
    }

    function selectPlan(amount) {
      db.ref("users/" + currentUser).update({ plan: amount });
      document.getElementById("plan").classList.add("hidden");
      showDashboard({ balance: 0, plan: amount });
    }

    function showDashboard(data) {
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("userName").innerText = currentUser;
      document.getElementById("userPlan").innerText = data.plan;
      document.getElementById("userBalance").innerText = data.balance;
      document.getElementById("refLink").value = location.href + "?ref=" + currentUser;
    }

    function requestWithdraw() {
      const amt = document.getElementById("withdrawAmount").value;
      const trx = document.getElementById("trxId").value;
      if (!amt || !trx) return alert("Fill all fields");
      db.ref("withdrawRequests").push({ user: currentUser, amount: amt, trx });
      alert("Request sent");
    }

    function startTimer(btn) {
      btn.disabled = true;
      let secs = 120;
      const interval = setInterval(() => {
        btn.innerText = `Wait ${secs}s...`;
        secs--;
        if (secs < 0) {
          clearInterval(interval);
          btn.innerText = "Task Complete âœ…";
          btn.disabled = false;
          db.ref("users/" + currentUser + "/balance").once("value").then(s => {
            const bal = s.val() || 0;
            db.ref("users/" + currentUser).update({ balance: bal + 5 });
            document.getElementById("userBalance").innerText = bal + 5;
          });
        }
      }, 1000);
    }

    window.onload = function () {
      const ref = new URLSearchParams(location.search).get("ref");
      if (ref) localStorage.setItem("refUser", ref);

      auth.onAuthStateChanged(user => {
        if (user) {
          const uname = user.email.split("@")[0];
          currentUser = uname;
          checkUserPlan();

          const refBy = localStorage.getItem("refUser");
          if (refBy && refBy !== uname) {
            db.ref("users/" + refBy + "/balance").once("value").then(s => {
              const bal = s.val() || 0;
              db.ref("users/" + refBy).update({ balance: bal + 2 });
            });
            localStorage.removeItem("refUser");
          }
        }
      });
    }
  </script>
</body>
</html>
